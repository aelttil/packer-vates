#cloud-config
autoinstall:
  version: 1
  locale: en_US.UTF-8
  keyboard:
    layout: us
  identity:
    hostname: ubuntu
    username: admct
    # Password: InitCT@2025
    password: "$6$rounds=4096$8dKUOuD/$mDpQhSWJ8qOKHRr0j0i6qE3mm.gk32XvGNtQBmHG1WxjJ8kNaCwOrdHq.2S7RpSQ490fT/9PqkGbGv3r/vvvf0"
  storage:
    layout:
      name: lvm
      sizing-policy: all
    config:
      - type: disk
        id: disk-sda
        ptable: gpt
        wipe: superblock
        grub_device: true
      - type: partition
        id: partition-0
        device: disk-sda
        size: 512M
        flag: boot
        grub_device: true
        number: 1
      - type: partition
        id: partition-1
        device: disk-sda
        size: 1G
        number: 2
      - type: partition
        id: partition-2
        device: disk-sda
        size: -1
        number: 3
      - type: format
        id: format-0
        fstype: fat32
        volume: partition-0
      - type: format
        id: format-1
        fstype: xfs
        volume: partition-1
      - type: mount
        id: mount-0
        device: format-0
        path: /boot/efi
      - type: mount
        id: mount-1
        device: format-1
        path: /boot
      - type: lvm_volgroup
        id: lvm_volgroup-0
        name: vg_sys
        devices:
          - partition-2
      - type: lvm_partition
        id: lvm_partition-0
        name: lv_root
        volgroup: lvm_volgroup-0
        size: 10G
      - type: lvm_partition
        id: lvm_partition-1
        name: lv_swap
        volgroup: lvm_volgroup-0
        size: 4G
      - type: lvm_partition
        id: lvm_partition-2
        name: lv_var
        volgroup: lvm_volgroup-0
        size: 4G
      - type: lvm_partition
        id: lvm_partition-3
        name: lv_home
        volgroup: lvm_volgroup-0
        size: 1G
      - type: lvm_partition
        id: lvm_partition-4
        name: lv_opt
        volgroup: lvm_volgroup-0
        size: 1G
      - type: lvm_partition
        id: lvm_partition-5
        name: lv_tmp
        volgroup: lvm_volgroup-0
        size: 1G
      - type: lvm_partition
        id: lvm_partition-6
        name: lv_vartmp
        volgroup: lvm_volgroup-0
        size: 1G
      - type: lvm_partition
        id: lvm_partition-7
        name: lv_varlog
        volgroup: lvm_volgroup-0
        size: 5G
      - type: lvm_partition
        id: lvm_partition-8
        name: lv_varlogaudit
        volgroup: lvm_volgroup-0
        size: 1G
      - type: format
        id: format-2
        fstype: xfs
        volume: lvm_partition-0
      - type: format
        id: format-3
        fstype: swap
        volume: lvm_partition-1
      - type: format
        id: format-4
        fstype: xfs
        volume: lvm_partition-2
      - type: format
        id: format-5
        fstype: xfs
        volume: lvm_partition-3
      - type: format
        id: format-6
        fstype: xfs
        volume: lvm_partition-4
      - type: format
        id: format-7
        fstype: xfs
        volume: lvm_partition-5
      - type: format
        id: format-8
        fstype: xfs
        volume: lvm_partition-6
      - type: format
        id: format-9
        fstype: xfs
        volume: lvm_partition-7
      - type: format
        id: format-10
        fstype: xfs
        volume: lvm_partition-8
      - type: mount
        id: mount-2
        device: format-2
        path: /
      - type: mount
        id: mount-3
        device: format-3
        path: none
      - type: mount
        id: mount-4
        device: format-4
        path: /var
      - type: mount
        id: mount-5
        device: format-5
        path: /home
      - type: mount
        id: mount-6
        device: format-6
        path: /opt
      - type: mount
        id: mount-7
        device: format-7
        path: /tmp
      - type: mount
        id: mount-8
        device: format-8
        path: /var/tmp
      - type: mount
        id: mount-9
        device: format-9
        path: /var/log
      - type: mount
        id: mount-10
        device: format-10
        path: /var/log/audit
  network:
    network:
      version: 2
      ethernets:
        eth0:
          dhcp4: true
  ssh:
    install-server: true
    allow-pw: true
  packages:
    - openssh-server
    - sudo
    - curl
    - wget
    - vim
    - qemu-guest-agent
  user-data:
    users:
      - name: admct
        sudo: ALL=(ALL) NOPASSWD:ALL
  late-commands:
    - echo 'admct ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/admct
    - chmod 440 /target/etc/sudoers.d/admct
